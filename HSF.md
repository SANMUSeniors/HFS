# HFS概述

高速服务框架 HSF (High-speed Service Framework)，是在阿里巴巴内部广泛使用的分布式 RPC 服务框架。

HSF 联通不同的业务系统，解耦系统间的实现依赖。HSF 从分布式应用的层面，统一了服务的发布/调用方式，从而帮助您方便、快速的开发分布式应用，以及提供或使用公共功能模块，并屏蔽了分布式领域中的各种复杂技术细节，如：远程通讯、序列化实现、性能损耗、同步/异步调用方式的实现等。
## HSF 架构
HSF 作为一个纯客户端架构的 RPC 框架，本身是没有服务端集群的，所有的 HSF 服务调用都是服务消费方（Consumer）与服务提供方（Provider）点对点进行的。然而，为了实现整套分布式服务体系，HSF 还需要依赖以下外部系统。


![HSF](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/100087/cn_zh/1553483922566/edas-appDev-hsf-archi.png "HSF")

* 地址注册中心
HSF 依赖注册中心进行服务发现，如果没有注册中心，HSF 只能完成简单的点对点调用。因为作为服务提供端，没有办法将自己的服务信息对外发布，让外界知晓；作为服务消费端，可能已经知道需要调用的服务，但是无法获取能够提供这些服务的机器。而注册中心就是服务信息的中介，提供服务发现的能力。地址注册中心的角色是由 ConfigServer 承担的。
* 持久化配置中心
持久化的配置中心用于存储 HSF 服务的各种治理规则，HSF 客户端在启动的过程中会向持久化配置中心订阅各种服务治理规则，如路由规则、归组规则、权重规则等，从而根据规则对调用过程的选址逻辑进行干预。持久化配置中心的角色是由 Diamond 承担的。
* 元数据存储中心
元数据是指 HSF 服务对应的方法列表以及参数结构等信息，元数据不会对 HSF 的调用过程产生影响，因此元数据存储中心也并不是必须的。但考虑到服务运维的便捷性，HSF客户端在启动时会将元数据上报到元数据存储中心，以便提供给服务运维使用。元数据存储中心的角色是由 Redis 承担的。

## 功能
HSF 作为分布式 RPC 服务框架，支持多种服务的调用方式
* 同步调用
HSF 客户端默认以同步调用的方式消费服务，客户端代码需要同步等待返回结果
* 异步调用
对于服务调用的客户端来说，并不是所有的 HSF 服务都需要同步等待返回结果的。对于这些服务，HSF 提供异步调用的形式，让客户端不必同步阻塞在 HSF 调用操作上。HSF 的异步调用，有 2 种：
    + Future 调用：客户端在需要获取调用的返回结果时，通过 HSFResponseFuture.getResponse(int timeout) 主动获取结果。
    + Callback 调用：Callback 调用利用 HSF 内部提供的回调机制，当指定的 HSF 服务消费完毕拿到返回结果时，HSF框架会回调用户实现的HSFResponse -Callback 接口，客户端通过回调通知的方式获取结果。
* 泛化调用
对于一般的 HSF 调用来说，HSF 客户端需要依赖服务的二方包，通过依赖二方包中的 API 进行编程调用，获取返回结果。而泛化调用是指不需要依赖服务的二方包，从而发起 HSF 调用、获取返回结果的方式。在一些平台型的产品中，泛化调用的方式可以有效减少平台型产品的二方包依赖，实现系统的轻量级运行。

注：
一方包（也称一方库）、二方包（也称二方库）、三方包（也称三方库）说明：
一方包：本工程中的各模块的相互依赖
二方包：公司内部的依赖库，一般指公司内部的其他项目发布的jar包
三方包：公司之外的开源库， 比如apache、ibm、google等发布的依赖

* HTTP 调用
HSF 支持将服务以 HTTP 的形式暴露出来，从而支持非 Java 语言的客户端以 HTTP 协议进行服务调用。

*调用链路 Filter 扩展
HSF 内部设计了调用过滤器，并且能够主动发现用户的调用过滤器扩展点，将其集成到 HSF 调用链路中，使扩展方能够方便的对 HSF 请求进行扩展处理。

## 应用开发方式

使用 HSF 框架开发应用包含 Ali-Tomcat 和 Pandora Boot 两种方式。
* Ali-Tomcat： 依赖 Ali-Tomcat 和 Pandora，可以提供完整的 HSF 功能，包括服务注册与发现、隐式传参、异步调用、泛化调用和调用链路 Filter 扩展。应用程序需要以 WAR 包方式部署。
* Pandora Boot：依赖 Pandora，可以提供比较完整的 HSF 功能，包括服务注册与发现和异步调用。应用程序可以打包成独立运行的 JAR 包并部署。
